<!doctype html>
<html>
<head>
	<meta http-equiv='content-type' content='text/html;charset=utf-8'></meta>
	<script type='text/javascript' src='https://code.jquery.com/jquery-2.1.3.js'></script>
	<script>
		var id_num = 0, first_iteration = true, plot_id = '2',visualizing = false;
		function plot(data,first_iteration){	//receive data from perm_op.py; generate plot and append to document
			var set_size = data[0], iterator = data[1], map = data[2];
			var oi = $('#iterator').val();
			if (oi.indexOf('.') != '-1'){		// format incoming iteration value for display
				var dec_places = oi.length - 1 - oi.indexOf('.');
				iterator = parseFloat(parseInt(iterator * Math.pow(10,dec_places))/Math.pow(10.,dec_places));
			}
			else{
				iterator = parseInt(iterator);
			}
			$('#current').html(iterator);
			if ( ! $('#iterator_check').is(':checked')){	// standard single graph; no continuous iteration				
				var new_plot = document.createElement('div');
				plot_id = 'plot' + id_num;
				new_plot.id = plot_id;
				new_plot.className = 'plot';
				$('#plots').append(new_plot);
				$('#'+plot_id).css({
					'height':2*set_size,
					'width':2*set_size
				});
				for (i = 0; i < map.length; i++){
					var point = document.createElement('div');
					point.className = 'point';
					point.style.marginLeft = i*2+'px';
					point.style.marginTop = 2*set_size - 2*map[i]+'px';
					$('#'+plot_id).append(point);
				}
				id_num++;
			}
			else{											// generate dynamic data from iteration update 
				if (first_iteration){
					first_iteration = false;
					var new_plot = document.createElement('div');	//create html elements
					plot_id = 'plot' + id_num;
					new_plot.id = plot_id;
					new_plot.className = 'plot';
					$('#plots').append(new_plot);
					$('#'+plot_id).css({
						'height':2*set_size,
						'width':2*set_size
					});	
					for (i = 0; i < map.length; i++){		//plot all points from data set
						var point = document.createElement('div');
						point.className = 'point';
						point.style.marginLeft = i*2+'px';
						point.style.marginTop = 2*set_size - 2*map[i]+'px';
						$('#'+plot_id).append(point);
					}
					id_num++;					
				}
				else{										//dynamic data plot - draw over and replace existing plot data
					$('#'+plot_id).html('');
					for (i = 0; i < map.length; i++){
						var point = document.createElement('div');
						point.className = 'point';
						point.style.marginLeft = i*2+'px';
						point.style.marginTop = 2*set_size - 2*map[i]+'px';
						$('#'+plot_id).append(point);
					}
				}
			}
		}

		function process_data(set_size,iterator){
			var iterator_change = $('#iterator_check').is(':checked');
			if (! iterator_change){	//no iterator_change; process data as single graph (version 1/standard mode)
				$.ajax({
					method:'post',
					url:'perm_op.py',		//python script to generate data array 
					data:{'package':JSON.stringify([set_size,iterator])},
					success: function(response){
						response = JSON.parse(response);
						plot(response,null);
					}
				});
			}
			else{	//iterator_change data for auto-processing/continuous updates to visualization graph
				var n = iterator;
				var graphing = setInterval(function(){		//start dynamic updating 
					visualizing = true;				
					$('#iterator_stop').click(function(){	//stop iteration
						visualizing = false;
						clearInterval(graphing);
					});
					$.ajax({
						method:'post',
						url:'perm_op.py',		//get array data for plotting
						data:{'package':JSON.stringify([set_size,iterator])},
						success: function(response){
							response = JSON.parse(response);
							plot(response,first_iteration);		//plot data
							first_iteration = false;
						}
					});
					iterator += n;
				},50);
				
			}
		}

		$(document).on('click','#visualize',function(){	//generate data; send user values through ajax to perm_op.py
			if (visualizing){return}		//ignore multiple clicks
			var set_size = $('#set_size').val();
			var iterator = $('#iterator').val();
			$('#message').html('');
			if (!(isNaN(set_size) || isNaN(iterator)) && $('#set_size').val() > 0 && $('#iterator').val() > 0 ){	//standard input data is ok
				process_data(parseInt(set_size),parseFloat(iterator));
			}
			else{
				$('#message').html('Check inputs. ');	//bad standard input data
			}
		});
		
	</script>	
</head>
<body>
	<div id='container'>

		<span id='input_box'>
			Permutation Set Visualizer <br>
			<span class='input'>set size: <textarea class='ta' id='set_size'>100</textarea></span><br>
			<span class='input'>iterator: <textarea class='ta' id='iterator'>.1</textarea></span><br>
			<button id='visualize'>visualize</button>
		</span>
		
		<div id='automate'>
			Dynamic Iterator: <input type='checkbox' id='iterator_check' checked/><br>
			<button id='iterator_stop'>stop</button>
		</div>
		
		<div id='message_box'>
			<span id='message'></span><br>
			<span>iteration: <span id='current'></span></span>
		</div><br>
		<div id='plots'>	
		</div>		
		
	</div>
	
	<style>
		.input{
			vertical-align:top;
		}
		#iterator_check{
			margin-bottom:4px;
		}
		#d_iterator{
			vertical-align:top;
			
		}
		#automate{
			text-align:center;
			display:inline-block;
			vertical-align:top;
			margin-left:20px;
			width:200px;
			height:200px;
			/*
			border-color:black;
			border-style:solid;
			border-width:1px;
			*/
		}
		.point{
			height:2px;
			width:2px;
			border-radius:2px;
			background-color:blue;
			display:inline-block;
			position:absolute;
		}
		.plot_outer{
			padding:5px;
		}	
		.plot{
			border-style:solid;
			border-color:black;
			border-width:1px;
			display:inline-block;
			margin:1px;
			padding:1px;
		}
		#message_box{
			vertical-align:top;
			margin-left:20px;
			display:inline-block;
		}
		#message{
			color:red;
			font-size:12px;
		}
		#input_box{
			display:inline-block;
			text-align:center;
			width:180px;
		}
		.ta{
			resize:none;
			height:13px;
			width:40px;
		}
		#container{
			display:inline-block;
		}
	</style>
</body>
</html>